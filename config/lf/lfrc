#--------------------------------
#
# Last modification : 2023.12.21
# Author            : Lasercata
# Version           : v1.0.0
#
#--------------------------------

# Sources :
#   - https://github.com/gokcehan/lf/wiki/Tips 
#   - https://pkg.go.dev/github.com/chrispenner/lf
#   - https://github.com/gokcehan/lf/blob/master/etc/lfrc.example

# interpreter for shell commands
set shell sh

# set '-eu' options for shell commands
# These options are used to have safer shell commands. Option '-e' is used to
# exit on error and option '-u' is used to give error for unset variables.
# Option '-f' disables pathname expansion which can be useful when $f, $fs, and
# $fx variables contain names with '*' or '?' characters. However, this option
# is used selectively within individual commands as it can be limiting at
# times.
set shellopts '-eu'

# set internal field separator (IFS) to "\n" for shell commands
# # This is useful to automatically split file names in $fs and $fx properly
# # since default file separator used in these variables (i.e. 'filesep' option)
# # is newline. You need to consider the values of these options and create your
# # commands accordingly.
# set ifs "\n"

set scrolloff 3
set tabstop 4
set info size
set icons true

map zi set icons!

# Set binding to go edit this file
cmd edit-config ${{
    $EDITOR ~/.config/lf/lfrc
    lf -remote "send $id source ~/.config/lf/lfrc"
}}

map C edit-config

# Toggle preview
cmd toggle_preview %{{
    if [ "$lf_preview" = "true" ]; then
        lf -remote "send $id :set preview false; set ratios 1:5"
    else
        lf -remote "send $id :set preview true; set ratios 1:2:3"
    fi
}}

map zp toggle_preview

# map toggle hidden
map <backspace2> set hidden!

# "visual" mode
map V invert-below

# Choose which app use to open the selected file
map o $mimeopen --ask $f

# preview dir cursor
set cursorpreviewfmt "\033[7m"

# Execute file
map xx !$f
map X &$f

# Show execution results
map S !true

# Trash
# cmd trash $trash -v $fx
cmd trash $IFS="$(printf '\n\t')"; trash -v $fx
cmd trash-restore $trash-restore

map DD trash
map Du trash-restore

# Extract the current file with the right command
# (xkcd link: https://xkcd.com/1168/)
cmd extract ${{
    set -f
    case $f in
        *.tar.bz|*.tar.bz2|*.tbz|*.tbz2) tar xjvf $f;;
        *.tar.gz|*.tgz) tar xzvf $f;;
        *.tar.xz|*.txz) tar xJvf $f;;
        *.zip) unzip $f;;
        *.rar) unrar x $f;;
        *.7z) 7z x $f;;
    esac
}}

map xt extract

# previewer
set previewer ~/.config/lf/pv.sh
map i $~/.config/lf/pv.sh "$f" | bat

# vim:ft=conf
